#!/bin/bash
set -euo pipefail
IFS=$'\n\t'

bundle install

# Do any other automated setup that you need to do here
# NOTE: Assumes current user has ability to create roles in psql
psql -U `whoami` -f bin/setup.sql
echo "Setup Role foss"
psql -c 'CREATE DATABASE celluloid_io_pg_listener_test;' -U foss
psql -c 'ALTER DATABASE celluloid_io_pg_listener_test OWNER TO "foss";' -U foss
echo "Setup Database celluloid_io_pg_listener_test"

cd spec/apps
bundle install
SKIP_RAILS_ROOT_OVERRIDE=true bundle exec rake test_db_setup

cd ../..
appraisal rspec
